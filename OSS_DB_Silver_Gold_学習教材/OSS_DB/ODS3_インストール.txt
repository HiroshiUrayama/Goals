’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
'データベースクラスタの構造
’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
データベースクラスタ：PostgreSQLのデータベースのファイルを格納する領域のこと。
データベースクラスタを作成する場所は、ユーザが自由に選べる。
PostgreSQLサーバとデータベースクラスタは1対1で管理する。

ファイルシステム上の1つのディレクトリ。
    データベースクラスタを作るコマンド：
    または、pg_ctl initdb(init)でもinitdbと同様の処理が行われる

$PGDATA
    base/               データベースごとのサブディレクトリを格納する
                            データベースクラスタに対して1つしかできない。
    global/             ユーザ情報など、共有データを格納する
    log/                   ログファイルを格納する
    postgresql.conf     パラメータを設定する
    pg_hba.conf         クライアント認証情報を設定する
                                データベースクラスタに対して1つしかできない。
    postmaster.pid      実行中のプロセスを識別し記録する

initdbコマンドは、データベースクラスタを作成するホスト上で、
root以外のOSユーザで実行する。ネットワーク経由で他のホストから実行することはできない。

データベースクラスタをrootユーザで実行、所有することは出来ない。
’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
'initdbとDBクラスタの設定
’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
initdbコマンド
    データベースクラスタを作成(データベースを作成する時のみ)
        データベースクラスタは、PostgreSQLのデータベースファイルを格納する領域のこと。
        ファイルシステム上の1つのディレクトリのこと。
        
        template0    
            データベースを新規に作成する際にコピー元になる(変更不可)
                変更を加えられないので、オブジェクトとかも追加できない
        template1
            データベースを新規に作成する際にコピー元になる(変更可)
                変更を加えられるので、オブジェクト追加、任意の変更ができる
                    *template1は、テンプレートの指定を省略した場合にデフォルトで使われる
        postgres
            通常のDBと同様に使える

            テンプレートDBへの操作は、コピーして作成されたデータベースには影響しない。

        データベースクラスタは、Postgreサーバと1対1で対応する。
            複数のサーバで1つのデータベースクラスタを分散管理することは出来ない。
            
        データベースクラスタの作成場所は、ユーザが自由に設定することができる。

        PostgreSQLサーバとデータベースクラスタは1対1で管理する。

        initdbは、データベースクラスタを作成するホスト上(サーバ、ローカル？)で、
        root以外のOSユーザで実行する。→生成されたデータベースクラスタの管理ユーザになる。
        ネットワーク経由で他のホストから実行することは出来ない。

    指定タイミング
        ・×テーブルの作成時
        ・×データベースクラスタの作成時
’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
'initdbコマンドのオプション
’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
ローカルホストからしか実行できない(もともと、サーバ上で動かすことが前提)。
    リモートホストからは実行不可能。
データベースクラスタを新しく作成するコマンド。
データベースクラスタを作成するホスト上で、root以外のOSユーザで実行。
ネットワーク経由で他のホストから実行することはできない。
実行したOSユーザは、生成されたデータベースクラスタの管理ユーザ(PostgreSQLの管理ユーザ)になる。

1.  -D ディレクトリ名   --pgdata=ディレクトリ名     
    データベースクラスタを作成するディレクトリを指定する
        指定したディレクトリが存在していても、空だったらデータベースクラスタの作成が可能。
        ※既にデータベースクラスタが作成されたディレクトリを指定して、initdbを実行することはできない。
            ∴上書きはされない。
    指定しない場合は、環境変数「$PGDATA」の値をディレクトリパスとして使用する。

    データベースクラスタのディレクトリは、環境変数「＄PGDATA」の値、
    または、initdb実行時の引数で指定する。
    指定したディレクトリが存在していない場合は、新規に作成される。
        親ディレクトリにOSユーザの書き込み権限が必要。

2.  -E エンコーディング --encoding=エンコーディング
    エンコーディングを指定する
        ★指定しない場合は、OSのロケールから自動的に設定される

3. --locale=ロケール
    ロケールを指定する　指定しない場合は、OSのロケールが使われる
    「--locale=C」は、ロケールを無効にする

4. --no-locale ロケールを無効にする「--locale=C」と同じ

5. -U ユーザ名 作成するデータベースのスーパユーザ名を指定する
        ★指定しない場合は、コマンドを実行したOSユーザ名でスーパーユーザが作成される

6. -k --data-checksums データベースのチェックサム(データ破損をチェックする仕組み)を有効にする。

7. -X ディレクトリ名 --waldir=ディレクトリ名　WAL(Write Ahead Logging:データベースへの変更を記録したログ)を格納するディレクトリを指定する

’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
'エンコーディング
’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
initdbコマンドのオプションで指定する。
    例：initdb --encofing=EUC_JP

データベースに格納する文字データのエンコーディング
    データベースエンコーディング(サーバエンコーディング)という。
クライアント側が使用するエンコーディング
    クライアントエンコーディング
        設定ファイル"postgresql.conf"ファイルのclient_encodingパラメータにエンコーディングを指定する。

データベースエンコーディングとクライアントエンコーディングが異なっていてもOK。
自動的に変換される。

データベースごとにエンコーディングが設定可能。

日本語のエンコーディング
    ・SJIS：×DB　○CL
    ・EUC-JP：○DB　○CL
    ・UTF-8：○DB　○CL

・ロケールを無効にせず、ロケールと互換性の無いデータベースエンコーディングを設定している場合は、
　PorstgreSQLがエラーを起こす可能性がある。

・日本語のデータを扱う場合は、ロケールを有効にすることが推奨されている
　PorstgreSQLで日本語のデータを扱う場合は、処理が遅くなるので、ロケールを予め無効にしておく。

’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
'サーバの環境構築
’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
<手順>
1.PostgreSQLのインストール
    ※ソースコードから行う
        ★gccなどのコンパイラが必要
    ※バイナリ・パッケージ(ソースコードをビルド済みのソフトウェア)を使用する
        PostgreSQLの開発コミュニティ以外でも作成されている。
        ★コンパイラ不要
    
2.データベースクラスタの作成
3.サーバの起動

一台のマシンに複数のバージョンをインストールして同時に稼働させることも可能。

initdbを実行したユーザがPostgreSQLの管理者ユーザとなる。
∴OSの管理者ユーザとPostgreSQLサーバの管理者ユーザは違う。

’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
'initdbコマンド
’＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
実行できる人：
    root(OSの管理者ユーザ)以外の一般ユーザのみ
    initdbコマンドを実行したユーザがPostgreSQLの管理者ユーザとなる。
    
データベースを作成する
    CREATE DATABASEまたはcreatedbコマンドを使用する

データベースを初期化する
    initdbコマンドは、データベースクラスタを初期化する

データベースクラスタのバックアップを取得する
    pg_dump,pg_dumpallコマンド,OSのcp,tarコマンド

データベースへの接続
    psqlコマンドを使用する

    <pg_controldataコマンド>
    ※initdbで初期化されるデータベースクラスタ全体の制御情報を取得する。
    ※取得される情報はデータベースクラスタ単位。
    ※実行は、initdbを実行したデータベースクラスタの管理ユーザで行う必要がある。

    pg_controldata [-D][ディレクトリ名]
        ディレクトリ名を省略
            環境変数「$PGDATA」に設定されているディレクトリの制御情報を取得する。 
